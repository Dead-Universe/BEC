
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The documentation for the BuildingsBench platform.">
      
      
        <meta name="author" content="Patrick Emami">
      
      
        <link rel="canonical" href="https://nrel.github.io/BuildingsBench/API/utilities/buildings_bench-evaluation/">
      
      
        <link rel="prev" href="../../models/buildings_bench-models/">
      
      
        <link rel="next" href="../buildings_bench-tokenizer/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>buildings_bench.evaluation - BuildingsBench</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.26e3688c.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../css/extra.css">
    
      <link rel="stylesheet" href="../../../css/github-permalink-style.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#buildings_benchevaluation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="BuildingsBench" class="md-header__button md-logo" aria-label="BuildingsBench" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BuildingsBench
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              buildings_bench.evaluation
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/NREL/BuildingsBench/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    NREL/BuildingsBench
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="BuildingsBench" class="md-nav__button md-logo" aria-label="BuildingsBench" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    BuildingsBench
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/NREL/BuildingsBench/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    NREL/BuildingsBench
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../running/" class="md-nav__link">
        Running The Benchmark
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/" class="md-nav__link">
        Tutorials
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
          Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../data/buildings_bench-data/" class="md-nav__link">
        buildings_bench.data
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          Models
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Models
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/buildings_bench-models/" class="md-nav__link">
        buildings_bench.models
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          Utilities
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Utilities
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          buildings_bench.evaluation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        buildings_bench.evaluation
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#simple-usage" class="md-nav__link">
    Simple usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-usage-with-scoring-rule" class="md-nav__link">
    Advanced usage (with scoring rule)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metrics_factory" class="md-nav__link">
    metrics_factory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scoring_rule_factory" class="md-nav__link">
    scoring_rule_factory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#all_metrics_list" class="md-nav__link">
    all_metrics_list
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#buildingtypes" class="md-nav__link">
    BuildingTypes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datasetmetricsmanager" class="md-nav__link">
    DatasetMetricsManager
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metricsmanager" class="md-nav__link">
    MetricsManager
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metrictype" class="md-nav__link">
    MetricType
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#buildingsbenchmetric" class="md-nav__link">
    BuildingsBenchMetric
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metric" class="md-nav__link">
    Metric
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#absolute_error" class="md-nav__link">
    absolute_error
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#squared_error" class="md-nav__link">
    squared_error
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bias_error" class="md-nav__link">
    bias_error
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scoringrule" class="md-nav__link">
    ScoringRule
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rankedprobabilityscore" class="md-nav__link">
    RankedProbabilityScore
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continuousrankedprobabilityscore" class="md-nav__link">
    ContinuousRankedProbabilityScore
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregate" class="md-nav__link">
    aggregate
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../buildings_bench-tokenizer/" class="md-nav__link">
        buildings_bench.tokenizer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../buildings_bench-transforms/" class="md-nav__link">
        buildings_bench.transforms
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../buildings_bench-utils/" class="md-nav__link">
        buildings_bench.utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="buildings_benchevaluation">buildings_bench.evaluation<a class="headerlink" href="#buildings_benchevaluation" title="Permanent link"></a></h1>
<p>The <code>buildings_bench.evaluation</code> module contains the main functionality for evaluting a model
on the benchmark tasks.</p>
<p>The <code>buildings_bench.evaluation.managers.DatasetMetricsManager</code> class is the main entry point.</p>
<h2 id="simple-usage">Simple usage<a class="headerlink" href="#simple-usage" title="Permanent link"></a></h2>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span> <span class="nn">buildings_bench</span> <span class="kn">import</span> <span class="n">BuildingTypes</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span> <span class="nn">buildings_bench.evaluation.managers</span> <span class="kn">import</span> <span class="n">DatasetMetricsManager</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># By default, the DatasetMetricsManager keeps track of NRMSE, NMAE, and NMBE</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">metrics_manager</span> <span class="o">=</span> <span class="n">DatasetMetricsManager</span><span class="p">()</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="c1"># Iterate over the dataset using our building dataset generator</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="k">for</span> <span class="n">building_name</span><span class="p">,</span> <span class="n">building_dataset</span> <span class="ow">in</span> <span class="n">buildings_datasets_generator</span><span class="p">:</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="c1"># Register a new building with the manager</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="n">metrics_manager</span><span class="o">.</span><span class="n">add_building_to_dataset_if_missing</span><span class="p">(</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>        <span class="n">dataset_name</span><span class="p">,</span> <span class="n">building_name</span><span class="p">,</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="p">)</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="c1"># Your model makes predictions</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="c1"># ...</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="c1"># Register the predictions with the manager</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="n">metrics_manager</span><span class="p">(</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>        <span class="n">dataset_name</span><span class="p">,</span>                 <span class="c1"># the name of the dataset, e.g., electricity</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>        <span class="n">building_name</span><span class="p">,</span>                <span class="c1"># the name of the building, e.g., MT_001</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>        <span class="n">continuous_targets</span><span class="p">,</span>           <span class="c1"># the ground truth 24 hour targets</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>        <span class="n">predictions</span><span class="p">,</span>                  <span class="c1"># the model&#39;s 24 hour predictions</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>        <span class="n">BuildingTypes</span><span class="o">.</span><span class="n">RESIDENTIAL_INT</span><span class="p">,</span>    <span class="c1"># an int indicating the building type</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>    <span class="p">)</span>
</span></code></pre></div>
<h2 id="advanced-usage-with-scoring-rule">Advanced usage (with scoring rule)<a class="headerlink" href="#advanced-usage-with-scoring-rule" title="Permanent link"></a></h2>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span> <span class="nn">buildings_bench.evaluation.managers</span> <span class="kn">import</span> <span class="n">DatasetMetricsManager</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kn">from</span> <span class="nn">buildings_bench.evaluation</span> <span class="kn">import</span> <span class="n">scoring_rule_factory</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">metrics_manager</span> <span class="o">=</span> <span class="n">DatasetMetricsManager</span><span class="p">(</span><span class="n">scoring_rule</span> <span class="o">=</span> <span class="n">scoring_rule_factory</span><span class="p">(</span><span class="s1">&#39;crps&#39;</span><span class="p">))</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="c1"># Iterate over the dataset</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="k">for</span> <span class="n">building_name</span><span class="p">,</span> <span class="n">building_dataset</span> <span class="ow">in</span> <span class="n">buildings_datasets_generator</span><span class="p">:</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="c1"># Register a new building with the manager</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    <span class="n">metrics_manager</span><span class="o">.</span><span class="n">add_building_to_dataset_if_missing</span><span class="p">(</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>        <span class="n">dataset_name</span><span class="p">,</span> <span class="n">building_name</span><span class="p">,</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>    <span class="p">)</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>    <span class="c1"># Your model makes predictions</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>    <span class="c1"># ...</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>    <span class="c1"># Register the predictions with the manager</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>    <span class="n">metrics_manager</span><span class="p">(</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>        <span class="n">dataset_name</span><span class="p">,</span>           <span class="c1"># the name of the dataset, e.g., electricity</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>        <span class="n">building_name</span><span class="p">,</span>          <span class="c1"># the name of the building, e.g., MT_001</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>        <span class="n">continuous_targets</span><span class="p">,</span>     <span class="c1"># the ground truth 24 hour targets</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>        <span class="n">predictions</span><span class="p">,</span>            <span class="c1"># the model&#39;s 24 hour predictions</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>        <span class="n">building_types_mask</span><span class="p">,</span>    <span class="c1"># a boolean tensor indicating building type</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>        <span class="n">y_categories</span><span class="o">=</span><span class="n">targets</span><span class="p">,</span>   <span class="c1"># for scoring rules, the ground truth (discrete categories if using tokenization)</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>        <span class="n">y_distribution_params</span><span class="o">=</span><span class="n">distribution_params</span><span class="p">,</span> <span class="c1"># for scoring rules, the distribution parameters</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>        <span class="n">centroids</span><span class="o">=</span><span class="n">centroids</span>   <span class="c1"># for scoring rules with categorical variables, the centroid values</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>    <span class="p">)</span>
</span></code></pre></div>
<hr />
<h2 id="metrics_factory">metrics_factory<a class="headerlink" href="#metrics_factory" title="Permanent link"></a></h2>


<div class="doc doc-object doc-function">



<h3 id="buildings_bench.evaluation.metrics_factory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">buildings_bench</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">metrics_factory</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">MetricType</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">MetricType</span><span class="o">.</span><span class="n">SCALAR</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Metric</span><span class="p">]</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Create a metric from a name.
By default, will return a scalar metric.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the metric.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>types</code></td>
          <td>
                <code><span title="typing.List">List</span>[MetricTypes]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The types of the metric.         </p>
            </div>
          </td>
          <td>
                <code>[MetricType.SCALAR]</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>metrics_list</code></td>          <td>
                <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="buildings_bench.evaluation.metrics.Metric" href="#buildings_bench.evaluation.metrics.Metric">Metric</a>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of metrics.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

  </div>

</div><h2 id="scoring_rule_factory">scoring_rule_factory<a class="headerlink" href="#scoring_rule_factory" title="Permanent link"></a></h2>


<div class="doc doc-object doc-function">



<h3 id="buildings_bench.evaluation.scoring_rule_factory" class="doc doc-heading">
<code class="highlight language-python"><span class="n">buildings_bench</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">scoring_rule_factory</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ScoringRule</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Create a scoring rule from a name.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the scoring rule.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>sr</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="buildings_bench.evaluation.scoring_rules.ScoringRule" href="#buildings_bench.evaluation.scoring_rules.ScoringRule">ScoringRule</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A scoring rule.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

  </div>

</div><h2 id="all_metrics_list">all_metrics_list<a class="headerlink" href="#all_metrics_list" title="Permanent link"></a></h2>


<div class="doc doc-object doc-function">



<h3 id="buildings_bench.evaluation.all_metrics_list" class="doc doc-heading">
<code class="highlight language-python"><span class="n">buildings_bench</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">all_metrics_list</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Metric</span><span class="p">]</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Returns all registered metrics.</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>metrics_list</code></td>          <td>
                <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="buildings_bench.evaluation.metrics.Metric" href="#buildings_bench.evaluation.metrics.Metric">Metric</a>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of metrics.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

  </div>

</div><hr />
<h2 id="buildingtypes">BuildingTypes<a class="headerlink" href="#buildingtypes" title="Permanent link"></a></h2>


<div class="doc doc-object doc-class">



<h3 id="buildings_bench.evaluation.managers.BuildingTypes" class="doc doc-heading">
        <code>buildings_bench.evaluation.managers.BuildingTypes</code>


</h3>


  <div class="doc doc-contents first">

  
      <p>Enum for supported types of buildings.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>RESIDENTIAL</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Residential building type.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>COMMERCIAL</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Commercial building type.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>RESIDENTIAL_INT</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Integer representation of residential building type (0).</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>COMMERCIAL_INT</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Integer representation of commercial building type (1).</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  

  <div class="doc doc-children">











  </div>

  </div>

</div><h2 id="datasetmetricsmanager">DatasetMetricsManager<a class="headerlink" href="#datasetmetricsmanager" title="Permanent link"></a></h2>


<div class="doc doc-object doc-class">



<h3 id="buildings_bench.evaluation.managers.DatasetMetricsManager" class="doc doc-heading">
        <code>buildings_bench.evaluation.managers.DatasetMetricsManager</code>


</h3>


  <div class="doc doc-contents first">

  
      <p>A class that manages a MetricsManager for each building
in one or more benchmark datasets. 
One DatasetMetricsManager can be used to keep track of all metrics
when evaluating a model on all of the benchmark's datasets.</p>
<p>This class wil create a Pandas Dataframe summary containing the metrics for each building.</p>
<p>Default metrics are NRMSE (CVRMSE), NMAE, NMBE.</p>



  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="buildings_bench.evaluation.managers.DatasetMetricsManager.summary" class="doc doc-heading">
<code class="highlight language-python"><span class="n">summary</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Return a summary of the metrics for the dataset.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dataset_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the dataset to summarize. If None,
summarize all datasets.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A Pandas dataframe with the following columns:</p>
<ul>
<li>dataset: The name of the dataset.</li>
<li>building_id: The unique ID of the building.</li>
<li>building_type: The type of the building.</li>
<li>metric: The name of the metric.</li>
<li>metric_type: The type of the metric. (scalar or hour_of_day)</li>
<li>value: The value of the metric.</li>
</ul>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="buildings_bench.evaluation.managers.DatasetMetricsManager.__call__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">building_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">y_true</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">building_types_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">building_type</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">BuildingTypes</span><span class="o">.</span><span class="n">COMMERCIAL_INT</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Compute metrics for a batch of predictions for a single building in a dataset.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dataset_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the dataset.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>building_id</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The unique building identifier.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y_true</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The true (unscaled) load values. (continuous)
shape is [batch_size, pred_len, 1]</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y_pred</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The predicted (unscaled) load values. (continuous)
shape is [batch_size, pred_len, 1]</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>building_types_mask</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A boolean mask indicating the building type of each building.
True (1) if commercial, False (0). Shape is [batch_size]. Default is None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>building_type</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The building type of the batch. Can be provided 
instead of building_types_mask if all buildings are of the same type.</p>
            </div>
          </td>
          <td>
                <code>BuildingTypes.COMMERCIAL_INT</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Other Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>y_categories</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The true load values. (quantized)</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>y_distribution_params</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>logits, Gaussian params, etc.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>centroids</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The bin values for the quantized load.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>loss</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The loss for the batch.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

  </div>

</div>



  </div>

  </div>

</div><h2 id="metricsmanager">MetricsManager<a class="headerlink" href="#metricsmanager" title="Permanent link"></a></h2>


<div class="doc doc-object doc-class">



<h3 id="buildings_bench.evaluation.managers.MetricsManager" class="doc doc-heading">
        <code>buildings_bench.evaluation.managers.MetricsManager</code>


</h3>


  <div class="doc doc-contents first">

  
      <p>A class that keeps track of all metrics (and a scoring rule)for one or more buildings.</p>
<p>Metrics are computed for each building type (residential and commercial).</p>
<p>Example:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span> <span class="nn">buildings_bench.evaluation.managers</span> <span class="kn">import</span> <span class="n">MetricsManager</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span> <span class="nn">buildings_bench.evaluation</span> <span class="kn">import</span> <span class="n">metrics_factory</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">from</span> <span class="nn">buildings_bench</span> <span class="kn">import</span> <span class="n">BuildingTypes</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">import</span> <span class="nn">torch</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="n">metrics_manager</span> <span class="o">=</span> <span class="n">MetricsManager</span><span class="p">(</span><span class="n">metrics</span><span class="o">=</span><span class="n">metrics_factory</span><span class="p">(</span><span class="s1">&#39;cvrmse&#39;</span><span class="p">))</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="n">metrics_manager</span><span class="p">(</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="n">y_true</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="n">y_pred</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">FloatTensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">building_type</span> <span class="o">=</span> <span class="n">BuildingTypes</span><span class="o">.</span><span class="n">RESIDENTIAL_INT</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="p">)</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics_manager</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="n">BuildingTypes</span><span class="o">.</span><span class="n">RESIDENTIAL</span><span class="p">]:</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">metric</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="c1"># prints tensor(0.)</span>
</span></code></pre></div>



  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="buildings_bench.evaluation.managers.MetricsManager.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Metric</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scoring_rule</span><span class="p">:</span> <span class="n">ScoringRule</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Initializes the MetricsManager.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>metrics</code></td>
          <td>
                <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="buildings_bench.evaluation.metrics.Metric" href="#buildings_bench.evaluation.metrics.Metric">Metric</a>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of metrics to compute for each
building type.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>scoring_rule</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="buildings_bench.evaluation.scoring_rules.ScoringRule" href="#buildings_bench.evaluation.scoring_rules.ScoringRule">ScoringRule</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A scoring rule to compute for each
building type.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="buildings_bench.evaluation.managers.MetricsManager.get_ppl" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_ppl</span><span class="p">()</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Returns the perplexity of the accumulated loss.</p>

  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="buildings_bench.evaluation.managers.MetricsManager.summary" class="doc doc-heading">
<code class="highlight language-python"><span class="n">summary</span><span class="p">(</span><span class="n">with_loss</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">with_ppl</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Return a summary of the metrics for the dataset.</p>
<p>A summary maps keys to objects of type Metric or ScoringRule.</p>

  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="buildings_bench.evaluation.managers.MetricsManager.reset" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reset</span><span class="p">(</span><span class="n">loss</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Reset the metrics.</p>

  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="buildings_bench.evaluation.managers.MetricsManager.__call__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">y_true</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">building_types_mask</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">building_type</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">BuildingTypes</span><span class="o">.</span><span class="n">COMMERCIAL_INT</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Compute metrics for a batch of predictions.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>y_true</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The true (unscaled) load values. (continuous)
shape is [batch_size, pred_len, 1]</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y_pred</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The predicted (unscaled) load values. (continuous)
shape is [batch_size, pred_len, 1]</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>building_types_mask</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A boolean mask indicating the building type of each building.
True (1) if commercial, False (0). Shape is [batch_size].</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>building_type</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The building type of the batch. Can be provided 
instead of building_types_mask if all buildings are of the same type.</p>
            </div>
          </td>
          <td>
                <code>BuildingTypes.COMMERCIAL_INT</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Other Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>y_categories</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The true load values. (quantized)</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>y_distribution_params</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>logits, Gaussian params, etc.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>centroids</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The bin values for the quantized load.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>loss</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The loss for the batch.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

  </div>

</div>



  </div>

  </div>

</div><hr />
<h2 id="metrictype">MetricType<a class="headerlink" href="#metrictype" title="Permanent link"></a></h2>


<div class="doc doc-object doc-class">



<h3 id="buildings_bench.evaluation.metrics.MetricType" class="doc doc-heading">
        <code>buildings_bench.evaluation.metrics.MetricType</code>


</h3>


  <div class="doc doc-contents first">

  
      <p>Enum class for metric types.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>SCALAR</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A scalar metric.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>HOUR_OF_DAY</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A metric that is calculated for each hour of the day.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  

  <div class="doc doc-children">











  </div>

  </div>

</div><h2 id="buildingsbenchmetric">BuildingsBenchMetric<a class="headerlink" href="#buildingsbenchmetric" title="Permanent link"></a></h2>


<div class="doc doc-object doc-class">



<h3 id="buildings_bench.evaluation.metrics.BuildingsBenchMetric" class="doc doc-heading">
        <code>buildings_bench.evaluation.metrics.BuildingsBenchMetric</code>


</h3>


  <div class="doc doc-contents first">

  
      <p>An abstract class for all metrics.</p>
<p>The basic idea is to acculumate the errors etc. in a list and then
calculate the mean of the errors etc. at the end of the evaluation.</p>
<p>Calling the metric will add the error to the list of errors. Calling <code>.mean()</code>
will calculate the mean of the errors, populating the <code>.value</code> attribute.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the metric.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>type</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="buildings_bench.evaluation.metrics.MetricType" href="#buildings_bench.evaluation.metrics.MetricType">MetricType</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of the metric.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>value</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The value of the metric.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  

  <div class="doc doc-children">











  </div>

  </div>

</div><h2 id="metric">Metric<a class="headerlink" href="#metric" title="Permanent link"></a></h2>


<div class="doc doc-object doc-class">



<h3 id="buildings_bench.evaluation.metrics.Metric" class="doc doc-heading">
        <code>buildings_bench.evaluation.metrics.Metric</code>


</h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="buildings_bench.evaluation.metrics.BuildingsBenchMetric" href="#buildings_bench.evaluation.metrics.BuildingsBenchMetric">BuildingsBenchMetric</a></code></p>

  
      <p>A class that represents an error metric.  </p>
<p>Example:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">rmse</span> <span class="o">=</span> <span class="n">Metric</span><span class="p">(</span><span class="s1">&#39;rmse&#39;</span><span class="p">,</span> <span class="n">MetricType</span><span class="o">.</span><span class="n">SCALAR</span><span class="p">,</span> <span class="n">squared_error</span><span class="p">,</span> <span class="n">sqrt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">mae</span> <span class="o">=</span> <span class="n">Metric</span><span class="p">(</span><span class="s1">&#39;mae&#39;</span><span class="p">,</span> <span class="n">MetricType</span><span class="o">.</span><span class="n">SCALAR</span><span class="p">,</span> <span class="n">absolute_error</span><span class="p">)</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">nmae</span> <span class="o">=</span> <span class="n">Metric</span><span class="p">(</span><span class="s1">&#39;nmae&#39;</span><span class="p">,</span> <span class="n">MetricType</span><span class="o">.</span><span class="n">SCALAR</span><span class="p">,</span> <span class="n">absolute_error</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">cvrmse</span> <span class="o">=</span> <span class="n">Metric</span><span class="p">(</span><span class="s1">&#39;cvrmse&#39;</span><span class="p">,</span> <span class="n">MetricType</span><span class="o">.</span><span class="n">SCALAR</span><span class="p">,</span> <span class="n">squared_error</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sqrt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">nmbe</span> <span class="o">=</span> <span class="n">Metric</span><span class="p">(</span><span class="s1">&#39;nmbe&#39;</span><span class="p">,</span> <span class="n">MetricType</span><span class="o">.</span><span class="n">SCALAR</span><span class="p">,</span> <span class="n">bias_error</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></code></pre></div>



  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="buildings_bench.evaluation.metrics.Metric.__call__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>y_true (torch.Tensor): shape [batch_size, pred_len]
y_pred (torch.Tensor): shape [batch_size, pred_len]</p>

  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="buildings_bench.evaluation.metrics.Metric.reset" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reset</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Reset the metric.</p>

  </div>

</div>

<div class="doc doc-object doc-function">



<h4 id="buildings_bench.evaluation.metrics.Metric.mean" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mean</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Calculate the mean of the error metric.</p>

  </div>

</div>



  </div>

  </div>

</div><h2 id="absolute_error">absolute_error<a class="headerlink" href="#absolute_error" title="Permanent link"></a></h2>


<div class="doc doc-object doc-function">



<h3 id="buildings_bench.evaluation.metrics.absolute_error" class="doc doc-heading">
<code class="highlight language-python"><span class="n">buildings_bench</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>A PyTorch method that calculates the absolute error (AE) metric.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>y_true</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>[batch, pred_len]</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y_pred</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>[batch, pred_len]</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>error</code></td>          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>[batch, pred_len]</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

  </div>

</div><h2 id="squared_error">squared_error<a class="headerlink" href="#squared_error" title="Permanent link"></a></h2>


<div class="doc doc-object doc-function">



<h3 id="buildings_bench.evaluation.metrics.squared_error" class="doc doc-heading">
<code class="highlight language-python"><span class="n">buildings_bench</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>A PyTorch method that calculates the squared error (SE) metric.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>y_true</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>[batch, pred_len]</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y_pred</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>[batch, pred_len]</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>error</code></td>          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>[batch, pred_len]</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

  </div>

</div><h2 id="bias_error">bias_error<a class="headerlink" href="#bias_error" title="Permanent link"></a></h2>


<div class="doc doc-object doc-function">



<h3 id="buildings_bench.evaluation.metrics.bias_error" class="doc doc-heading">
<code class="highlight language-python"><span class="n">buildings_bench</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">bias_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>A PyTorch method that calculates the bias error (BE) metric.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>y_true</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>[batch, pred_len]</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y_pred</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>[batch, pred_len]</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>error</code></td>          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>[batch, pred_len]</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

  </div>

</div><hr />
<h2 id="scoringrule">ScoringRule<a class="headerlink" href="#scoringrule" title="Permanent link"></a></h2>


<div class="doc doc-object doc-class">



<h3 id="buildings_bench.evaluation.scoring_rules.ScoringRule" class="doc doc-heading">
        <code>buildings_bench.evaluation.scoring_rules.ScoringRule</code>


</h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="buildings_bench.evaluation.metrics.BuildingsBenchMetric" href="#buildings_bench.evaluation.metrics.BuildingsBenchMetric">BuildingsBenchMetric</a></code></p>

  
      <p>An abstract class for all scoring rules.</p>



  

  <div class="doc doc-children">











  </div>

  </div>

</div><h2 id="rankedprobabilityscore">RankedProbabilityScore<a class="headerlink" href="#rankedprobabilityscore" title="Permanent link"></a></h2>


<div class="doc doc-object doc-class">



<h3 id="buildings_bench.evaluation.scoring_rules.RankedProbabilityScore" class="doc doc-heading">
        <code>buildings_bench.evaluation.scoring_rules.RankedProbabilityScore</code>


</h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="buildings_bench.evaluation.scoring_rules.ScoringRule" href="#buildings_bench.evaluation.scoring_rules.ScoringRule">ScoringRule</a></code></p>

  
      <p>A class that calculates the ranked probability score (RPS) metric
for categorical distributions.</p>



  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="buildings_bench.evaluation.scoring_rules.RankedProbabilityScore.rps" class="doc doc-heading">
<code class="highlight language-python"><span class="n">rps</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred_logits</span><span class="p">,</span> <span class="n">centroids</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>A PyTorch method that calculates the ranked probability score metric
   for categorical distributions.</p>
<p>Since the bin values are centroids of clusters along the real line,
   we have to compute the width of the bins by summing the distance to
   the left and right centroids of the bin (divided by 2), except for
   the first and last bins, where we only need to sum the distance to
   the right centroid of the first bin and the left centroid of the
   last bin, respectively.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>y_true</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>of shape [batch_size, seq_len, 1] categorical labels</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y_pred_logits</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>of shape [batch_size, seq_len, vocab_size] logits</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>centroids</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>of shape [vocab_size]</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  </div>

</div>



  </div>

  </div>

</div><h2 id="continuousrankedprobabilityscore">ContinuousRankedProbabilityScore<a class="headerlink" href="#continuousrankedprobabilityscore" title="Permanent link"></a></h2>


<div class="doc doc-object doc-class">



<h3 id="buildings_bench.evaluation.scoring_rules.ContinuousRankedProbabilityScore" class="doc doc-heading">
        <code>buildings_bench.evaluation.scoring_rules.ContinuousRankedProbabilityScore</code>


</h3>


  <div class="doc doc-contents first">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="buildings_bench.evaluation.scoring_rules.ScoringRule" href="#buildings_bench.evaluation.scoring_rules.ScoringRule">ScoringRule</a></code></p>

  
      <p>A class that calculates the Gaussian continuous ranked probability score (CRPS) metric.</p>



  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h4 id="buildings_bench.evaluation.scoring_rules.ContinuousRankedProbabilityScore.crps" class="doc doc-heading">
<code class="highlight language-python"><span class="n">crps</span><span class="p">(</span><span class="n">true_continuous</span><span class="p">,</span> <span class="n">y_pred_distribution_params</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Computes the Gaussian CRPS.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>true_continuous</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>of shape [batch_size, seq_len, 1]</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y_pred_distribution_params</code></td>
          <td>
                <code>torch.<span title="torch.Tensor">Tensor</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>of shape [batch_size, seq_len, 2]</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  </div>

</div>



  </div>

  </div>

</div><hr />
<h2 id="aggregate">aggregate<a class="headerlink" href="#aggregate" title="Permanent link"></a></h2>


<div class="doc doc-object doc-function">



<h3 id="buildings_bench.evaluation.aggregate.return_aggregate_median" class="doc doc-heading">
<code class="highlight language-python"><span class="n">buildings_bench</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">return_aggregate_median</span><span class="p">(</span><span class="n">model_list</span><span class="p">,</span> <span class="n">results_dir</span><span class="p">,</span> <span class="n">experiment</span> <span class="o">=</span> <span class="s1">&#39;zero_shot&#39;</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cvrmse&#39;</span><span class="p">],</span> <span class="n">exclude_simulated</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">only_simulated</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">oov_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">reps</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents first">
  
      <p>Compute the aggregate median for a list of models and metrics over all buildings.
Also returns the stratified 95% boostrap CIs for the aggregate median.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model_list</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of models to compute aggregate median for.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>results_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Path to directory containing results.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>experiment</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Experiment type. Defaults to 'zero_shot'.
Options: 'zero_shot', 'transfer_learning'.</p>
            </div>
          </td>
          <td>
                <code>&#39;zero_shot&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>metrics</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of metrics to compute aggregate median for. Defaults to ['cvrmse'].</p>
            </div>
          </td>
          <td>
                <code>[&#39;cvrmse&#39;]</code>
          </td>
        </tr>
        <tr>
          <td><code>exclude_simulated</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to exclude simulated data. Defaults to True.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>only_simulated</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to only include simulated data. Defaults to False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>oov_list</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of OOV buildings to exclude. Defaults to [].</p>
            </div>
          </td>
          <td>
                <code>[]</code>
          </td>
        </tr>
        <tr>
          <td><code>reps</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of bootstrap replicates to use. Defaults to 50000.</p>
            </div>
          </td>
          <td>
                <code>50000</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>result_dict</code></td>          <td>
                <code>Dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dictionary containing aggregate median and CIs for each metric and building type.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.sections", "toc.integrate", "header.autohide"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>